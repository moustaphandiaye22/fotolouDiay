<div class="dashboard-container">
  <div class="dashboard-header">
    <h1>Dashboard Administrateur</h1>
    <p class="dashboard-subtitle">Vue d'ensemble des statistiques et gestion de la plateforme</p>
  </div>

  <!-- Statistics Cards -->
  <div class="stats-grid" *ngIf="stats">
    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-content">
          <div class="stat-icon">
            <mat-icon>inventory_2</mat-icon>
          </div>
          <div class="stat-info">
            <h3>{{ stats.total }}</h3>
            <p>Total Produits</p>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-content">
          <div class="stat-icon pending">
            <mat-icon>schedule</mat-icon>
          </div>
          <div class="stat-info">
            <h3>{{ stats.enAttente }}</h3>
            <p>En Attente</p>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-content">
          <div class="stat-icon approved">
            <mat-icon>check_circle</mat-icon>
          </div>
          <div class="stat-info">
            <h3>{{ stats.valides }}</h3>
            <p>Validés</p>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-content">
          <div class="stat-icon vip">
            <mat-icon>star</mat-icon>
          </div>
          <div class="stat-info">
            <h3>{{ stats.vip }}</h3>
            <p>Produits VIP</p>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-content">
          <div class="stat-icon rejected">
            <mat-icon>cancel</mat-icon>
          </div>
          <div class="stat-info">
            <h3>{{ stats.rejetes }}</h3>
            <p>Rejetés</p>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-content">
          <div class="stat-icon expired">
            <mat-icon>schedule</mat-icon>
          </div>
          <div class="stat-info">
            <h3>{{ stats.expires }}</h3>
            <p>Expirés</p>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
    <p>Chargement des statistiques...</p>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="error-message">
    <mat-icon>error</mat-icon>
    <span>{{ errorMessage }}</span>
  </div>

  <!-- Tabs for different sections -->
  <mat-tab-group class="dashboard-tabs">
    <!-- Produits Tab -->
    <mat-tab label="Produits">
      <div class="tab-content">
        <!-- Recent Products Table -->
        <mat-card class="recent-products-card">
          <mat-card-header>
            <mat-card-title>Produits Récents</mat-card-title>
            <mat-card-subtitle>Gestion des dernières annonces soumises</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <table mat-table [dataSource]="recentProducts" class="products-table">
              <!-- Titre Column -->
              <ng-container matColumnDef="titre">
                <th mat-header-cell *matHeaderCellDef>Titre</th>
                <td mat-cell *matCellDef="let product">{{ product.titre }}</td>
              </ng-container>

              <!-- Statut Column -->
              <ng-container matColumnDef="statut">
                <th mat-header-cell *matHeaderCellDef>Statut</th>
                <td mat-cell *matCellDef="let product">
                  <mat-chip [color]="getStatutColor(product.statut)" selected>
                    {{ getStatutLabel(product.statut) }}
                  </mat-chip>
                </td>
              </ng-container>

              <!-- Date Column -->
              <ng-container matColumnDef="dateCreation">
                <th mat-header-cell *matHeaderCellDef>Date</th>
                <td mat-cell *matCellDef="let product">
                  {{ product.dateCreation | date:'dd/MM/yyyy' }}
                </td>
              </ng-container>

              <!-- Utilisateur Column -->
              <ng-container matColumnDef="utilisateur">
                <th mat-header-cell *matHeaderCellDef>Vendeur</th>
                <td mat-cell *matCellDef="let product">
                  {{ product.utilisateur?.prenom }} {{ product.utilisateur?.nom }}
                </td>
              </ng-container>

              <!-- Actions Column -->
              <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef>Actions</th>
                <td mat-cell *matCellDef="let product">
                  <div class="action-buttons" *ngIf="canModerate()">
                    <button mat-button color="primary"
                            (click)="validerProduit(product)"
                            *ngIf="product.statut === 'EN_ATTENTE'">
                      <mat-icon>check</mat-icon>
                      Valider
                    </button>
                    <button mat-button color="warn"
                            (click)="rejeterProduit(product)"
                            *ngIf="product.statut === 'EN_ATTENTE'">
                      <mat-icon>close</mat-icon>
                      Rejeter
                    </button>
                    <button mat-button [routerLink]="['/produits', product.id]">
                      <mat-icon>visibility</mat-icon>
                      Voir
                    </button>
                  </div>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>

            <div *ngIf="recentProducts.length === 0" class="no-products">
              <mat-icon>inventory_2</mat-icon>
              <p>Aucun produit récent</p>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-tab>

    <!-- Utilisateurs Tab -->
    <mat-tab label="Utilisateurs">
      <div class="tab-content">
        <mat-card class="users-card">
          <mat-card-header>
            <mat-card-title>Liste des Utilisateurs</mat-card-title>
            <mat-card-subtitle>Gestion des comptes utilisateurs</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <table mat-table [dataSource]="users" class="users-table">
              <!-- Nom Column -->
              <ng-container matColumnDef="nom">
                <th mat-header-cell *matHeaderCellDef>Nom</th>
                <td mat-cell *matCellDef="let user">{{ user.nom }}</td>
              </ng-container>

              <!-- Prénom Column -->
              <ng-container matColumnDef="prenom">
                <th mat-header-cell *matHeaderCellDef>Prénom</th>
                <td mat-cell *matCellDef="let user">{{ user.prenom || '-' }}</td>
              </ng-container>

              <!-- Email Column -->
              <ng-container matColumnDef="email">
                <th mat-header-cell *matHeaderCellDef>Email</th>
                <td mat-cell *matCellDef="let user">{{ user.email }}</td>
              </ng-container>

              <!-- Rôle Column -->
              <ng-container matColumnDef="role">
                <th mat-header-cell *matHeaderCellDef>Rôle</th>
                <td mat-cell *matCellDef="let user">
                  <mat-chip [color]="getRoleColor(user.role)" selected>
                    {{ getRoleLabel(user.role) }}
                  </mat-chip>
                </td>
              </ng-container>

              <!-- Statut Column -->
              <ng-container matColumnDef="estActif">
                <th mat-header-cell *matHeaderCellDef>Statut</th>
                <td mat-cell *matCellDef="let user">
                  <mat-chip [color]="user.estActif ? 'primary' : 'warn'" selected>
                    {{ user.estActif ? 'Actif' : 'Inactif' }}
                  </mat-chip>
                </td>
              </ng-container>

              <!-- Date Column -->
              <ng-container matColumnDef="dateCreation">
                <th mat-header-cell *matHeaderCellDef>Date d'inscription</th>
                <td mat-cell *matCellDef="let user">
                  {{ user.dateCreation | date:'dd/MM/yyyy' }}
                </td>
              </ng-container>

              <!-- Produits Column -->
              <ng-container matColumnDef="produits">
                <th mat-header-cell *matHeaderCellDef>Produits</th>
                <td mat-cell *matCellDef="let user">{{ user._count?.produits || 0 }}</td>
              </ng-container>

              <!-- Actions Column -->
              <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef>Actions</th>
                <td mat-cell *matCellDef="let user">
                  <div class="action-buttons">
                    <button mat-button color="primary"
                            (click)="toggleUserStatus(user)"
                            *ngIf="canModerate()">
                      <mat-icon>{{ user.estActif ? 'block' : 'check_circle' }}</mat-icon>
                      {{ user.estActif ? 'Désactiver' : 'Activer' }}
                    </button>
                    <button mat-button [routerLink]="['/profil', user.id]">
                      <mat-icon>visibility</mat-icon>
                      Voir Profil
                    </button>
                  </div>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="userColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: userColumns;"></tr>
            </table>

            <!-- Pagination -->
            <mat-paginator
              [length]="totalUsers"
              [pageSize]="pageSize"
              [pageSizeOptions]="[10, 20, 50, 100]"
              [pageIndex]="currentPage - 1"
              (page)="onPageChange($event)"
              showFirstLastButtons>
            </mat-paginator>

            <div *ngIf="users.length === 0" class="no-users">
              <mat-icon>people</mat-icon>
              <p>Aucun utilisateur trouvé</p>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>
