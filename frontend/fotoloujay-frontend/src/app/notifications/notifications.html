<div class="notifications-container">
  <div class="notifications-header">
    <h1><mat-icon>notifications</mat-icon> Mes Notifications</h1>
    <div class="header-info">
      <span *ngIf="unreadNotifications.length > 0" class="unread-count">
        {{ unreadNotifications.length }} notification{{ unreadNotifications.length > 1 ? 's' : '' }} non lue{{ unreadNotifications.length > 1 ? 's' : '' }}
      </span>
    </div>
  </div>

  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Chargement des notifications...</p>
  </div>

  <div *ngIf="errorMessage" class="error-message">
    <mat-icon>error</mat-icon> {{ errorMessage }}
  </div>

  <div *ngIf="!isLoading && !errorMessage" class="notifications-content">
    <!-- Bouton pour marquer toutes comme lues -->
    <div class="actions-bar" *ngIf="unreadNotifications.length > 0">
      <button class="btn btn-primary" (click)="markAllAsRead()">
        <mat-icon>done_all</mat-icon> Tout marquer comme lu
      </button>
    </div>

    <!-- Notifications non lues -->
    <div class="section" *ngIf="unreadNotifications.length > 0">
      <h2><mat-icon>mail</mat-icon> Non lues ({{ unreadNotifications.length }})</h2>
      <div class="notifications-list">
        <div
          *ngFor="let notification of unreadNotifications"
          class="notification-card unread"
          (click)="markAsRead(notification)">
          <div class="notification-icon">
            {{ getNotificationIcon(notification.type) }}
          </div>

          <div class="notification-content">
            <div class="notification-header">
              <h4>{{ notification.titre }}</h4>
              <span class="notification-type" [style.background-color]="getNotificationColor(notification.type)">
                {{ getNotificationTypeLabel(notification.type) }}
              </span>
            </div>

            <p class="notification-message">{{ notification.message }}</p>

            <div class="notification-footer">
              <span class="notification-date">{{ formatDate(notification.dateCreation) }}</span>
              <div class="notification-actions">
                <button class="btn-icon" (click)="markAsRead(notification); $event.stopPropagation()" title="Marquer comme lu">
                  <mat-icon>visibility</mat-icon>
                </button>
                <button class="btn-icon delete" (click)="deleteNotification(notification); $event.stopPropagation()" title="Supprimer">
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Message si aucune notification non lue -->
    <div *ngIf="unreadNotifications.length === 0" class="no-notifications">
      <mat-icon>check_circle</mat-icon>
      <h3>Aucune notification non lue</h3>
      <p>Vous êtes à jour !</p>
    </div>

    <!-- Toutes les notifications -->
    <div class="section" *ngIf="notifications.length > 0">
      <h2><mat-icon>list</mat-icon> Toutes les notifications ({{ notifications.length }})</h2>
      <div class="notifications-list">
        <div
          *ngFor="let notification of notifications"
          class="notification-card"
          [class.read]="notification.estLue"
          [class.unread]="!notification.estLue">

          <div class="notification-icon">
            {{ getNotificationIcon(notification.type) }}
          </div>

          <div class="notification-content">
            <div class="notification-header">
              <h4>{{ notification.titre }}</h4>
              <div class="notification-badges">
                <span class="notification-type" [style.background-color]="getNotificationColor(notification.type)">
                  {{ getNotificationTypeLabel(notification.type) }}
                </span>
                <span *ngIf="!notification.estLue" class="notification-status unread-status">Non lue</span>
              </div>
            </div>

            <p class="notification-message">{{ notification.message }}</p>

            <div class="notification-footer">
              <span class="notification-date">{{ formatDate(notification.dateCreation) }}</span>
              <div class="notification-actions">
                <button
                  class="btn-icon"
                  *ngIf="!notification.estLue"
                  (click)="markAsRead(notification)"
                  title="Marquer comme lu">
                  <mat-icon>visibility</mat-icon>
                </button>
                <button class="btn-icon delete" (click)="deleteNotification(notification)" title="Supprimer">
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Message si aucune notification -->
    <div *ngIf="notifications.length === 0" class="no-notifications">
      <mat-icon>inbox</mat-icon>
      <h3>Aucune notification</h3>
      <p>Vous n'avez pas encore de notifications.</p>
    </div>
  </div>
</div>